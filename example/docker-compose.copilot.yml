# Copilot CLI Sidecar - Local Development
#
# Simulates the K8s sidecar pattern locally using Docker Compose.
#
# Usage:
#   docker compose -f pkg/copilotcli/example/docker-compose.copilot.yml up
#
# Requirements:
#   - Set GITHUB_TOKEN in your environment or .env file
#   - Build the sidecar image first:
#     docker build -t copilot-cli-sidecar:latest -f pkg/copilotcli/example/Dockerfile.copilot-sidecar .

services:
  copilot-sidecar:
    build:
      context: ../../..
      dockerfile: pkg/copilotcli/example/Dockerfile.copilot-sidecar
    container_name: copilot-sidecar
    ports:
      - "4321:4321"
    environment:
      # Option A: GitHub token (set in .env or export before running)
      GITHUB_TOKEN: ${GITHUB_TOKEN:-}
      # Option B: BYOK
      # OPENAI_API_KEY: ${OPENAI_API_KEY:-}
    healthcheck:
      test: ["CMD", "bash", "-c", "echo > /dev/tcp/localhost/4321"]
      interval: 10s
      timeout: 3s
      start_period: 15s
      retries: 3
    restart: unless-stopped
